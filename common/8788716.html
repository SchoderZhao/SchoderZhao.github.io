<!DOCTYPE html>
<html>
    <head>
        <title>java公共组件 : loadBalancer路由策略扩展开发</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">java公共组件</a></span>
                            </li>
                                                    <li>
                                <span><a href="1409212.html">java公共组件</a></span>
                            </li>
                                                    <li>
                                <span><a href="8788587.html">21.Loadbalanced智能路由环境隔离</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            java公共组件 : loadBalancer路由策略扩展开发
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> 张印港</span>, last modified on 一月 24, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <hr /> 
<h2 id="date-created-2022-01-19-1525date-updated-2022-01-19-1541"><a href="#date-created-2022-01-19-1525date-updated-2022-01-19-1541">date created: 2022-01-19 15:25 date updated: 2022-01-19 15:41</a></h2> 
<h3 id="实现routingpolicy接口"><a href="#实现routingpolicy接口">实现RoutingPolicy接口</a></h3> 
<p>实现位于 <code>com.itjcloud.common.loadbalancer.core.RoutingPolicy</code> 的接口,然后注入spring中就可以实现对路由策略的扩展</p> 
<p>这个接口有两个方法</p> 
<ul><li>filtered筛选需要的路由列表</li><li>setHeaders 在feign调用中把需要传递的请求头传递给下个服务</li></ul> 
<pre><code class="language-java">
public interface RoutingPolicy extends Ordered {  
  
  /**  
 * 根据条件筛选返回需要的路由列表  
 *  
 * &#64;param instances 路由列表  
 * &#64;param request 请求头  
 * &#64;return 根据自己条件筛选的数据  
 */  
 List&lt;ServiceInstance&gt; filtered(List&lt;ServiceInstance&gt; instances, Request&lt;?&gt; request);  
  
  
 /**  
 * 从请求头李设置数据到headers  
 * * &#64;param headers 设置数据  
 * &#64;param httpServletRequest 接受的数据  
 * &#64;return list  
 */ Map&lt;String, String&gt; setHeaders(HttpServletRequest httpServletRequest);  
  
  
}

</code></pre> 
<blockquote> 
 <p>List&lt;ServiceInstance&gt;的数据结构如下</p> 
</blockquote> 
<p><img src="" alt="21.Loadbalanced只能路由环境隔离 - java公共组件 - Confluence (itjcloud.com)"/> 当然如果你看这两个默认路由策略不是很爽,你可以关闭他</p> 
<p> </p><script>
AJS.$('[data-macro-name="markdown"] code').each(function(i, block) {
    hljs.highlightBlock(block);
  });
</script><style>
.hljs {display: inline;}
pre > code {display: block !important;}
</style>
                    </div>

                                        
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on 八月 30, 2022 17:10</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
